# Mem0Graph – графовая визуализация памяти на базе Mem0 и Neo4j

Mem0Graph — это небольшое приложение на Streamlit, которое:

- **сохраняет воспоминания пользователя** через библиотеку `mem0` в векторное хранилище (ChromaDB) и граф Neo4j;
- **строит граф знаний** (узлы User / Memory / Entity и связи между ними) из Neo4j;
- **визуализирует граф** с помощью PyVis прямо в интерфейсе Streamlit;
- позволяет **общаться с агентом**, который использует сохранённые воспоминания как контекст.

---

## Стек технологий и объяснение выбора

- **Python 3.10+**
  - **Почему**: основной язык, в котором пишется ML/LLM‑экосистема; хорошая поддержка Neo4j/Streamlit/OpenAI‑SDK и быстрый цикл разработки.

- **Streamlit (`streamlit`)**
  - **Роль**: фронтенд и бэкенд в одном — быстрый способ собрать интерактивное веб‑приложение без отдельного React/JS‑фронта.
  - **Почему**: минимальный «клей», декларативный UI (чат, вкладки, сайдбар), удобно для прототипов и внутренних тулзов.

- **Mem0 (`mem0ai`)**
  - **Роль**: высокоуровневый слой работы с «памятью» пользователя (добавление, поиск, получение всех воспоминаний, интеграция с LLM и графом).
  - **Почему**: даёт готовую архитектуру memory‑store + graph‑store + LLM, чтобы не реализовывать всё вручную (ингест, хранение, поиск, связи).

- **ChromaDB (`chromadb`)**
  - **Роль**: векторное хранилище для эмбеддингов воспоминаний, используется как `vector_store` в конфиге Mem0.
  - **Почему**: простая встроенная БД (работает локально из коробки, хранит файлы в `./chroma_db`), хороша для небольших проектов и прототипов.

- **Neo4j (`neo4j`, `langchain_neo4j`)**
  - **Роль**: графовая база данных, куда Mem0 пишет сущности и связи (User, Memory, Entity и т.п.); источник данных для визуализации.
  - **Почему**: зрелая графовая СУБД, удобный Cypher‑язык, хороший tooling и Docker‑образ; отлично подходит для задач, где важны связи и путь в графе.

- **PyVis + NetworkX (`pyvis`, `networkx`)**
  - **Роль**: библиотека для рисования интерактивных графов в HTML (PyVis) и работы с графами в Python (NetworkX, в данном проекте фактически опционален).
  - **Почему**: PyVis легко встраивается в Streamlit через `st.components.v1.html`, даёт «из коробки» красивый интерактивный граф (зум, перетаскивание, подсказки).

- **OpenAI SDK (`openai`) + OpenRouter**
  - **Роль**: доступ к LLM‑модели (`openai/gpt-4o-mini`) через OpenRouter API (задаётся через `OPENAI_BASE_URL` и `OPENROUTER_API_KEY`).
  - **Почему**: единый стандартный SDK, лёгкая смена модели/провайдера, хорошая поддержка чатов.

- **Sentence Transformers (`sentence-transformers`)**
  - **Роль**: эмбеддер для превращения текста в векторы (`all-MiniLM-L6-v2`), который используется Mem0/Chroma.
  - **Почему**: популярная и быстрая модель, достаточно точная для пользовательских воспоминаний и небольших проектов.

- **Инфраструктура и утилиты**
  - `python-dotenv` — подтягивает переменные среды из `.env` (ключи API, base URL и т.п.).  
  - `PyPDF2` — парсинг PDF‑файлов, чтобы можно было заливать документы в память через интерфейс.  
  - `rank_bm25` — классический BM25‑поиск (может использоваться Mem0/окружением как дополнительный скорер).
  - `docker-compose` + образ `neo4j:5.26.0-community` — быстрого развёртывание Neo4j с плагином APOC для локальной разработки.

Выбор этого стека делает проект:

- **быстро поднимаемым локально** (Streamlit + Docker Neo4j + ChromaDB в папке);
- **удобным для экспериментов с памятью LLM** (Mem0 + Chroma + Neo4j);
- **достаточно гибким** для дальнейшего расширения (подмена LLM, хранилищ, доработка визуализации).

---

## Структура проекта

```text
Mem0_Graph/
├─ app.py                 # Главный Streamlit-приложение
├─ mem0_graph/            # Основной пакет приложения
│  ├─ __init__.py
│  ├─ config.py           # Конфигурация Mem0: ChromaDB, Neo4j, LLM, embedder
│  ├─ agent.py            # Класс Mem0Agent: чат, работа с памятью
│  └─ graph_viz.py        # Класс Neo4jGraphViz: запросы к Neo4j и визуализация PyVis
├─ scripts/               # Вспомогательные утилиты для отладки Neo4j/Mem0
│  ├─ debug_mem0.py       # Проверка работы Mem0: add/search/get_all
│  ├─ check_types.py      # Проверка типов labels в Neo4j
│  └─ inspect_neo4j.py    # Вывод структуры графа (лейблы, типы связей, примеры)
├─ tests/                 # Тестовые/демо-скрипты
│  ├─ test_memory_addition.py
│  └─ test_graph_query.py
├─ chroma_db/             # Локальная папка ChromaDB (создаётся Mem0)
├─ docker-compose.yml     # Поднятие Neo4j в Docker
├─ requirements.txt       # Python-зависимости
├─ knowledge_graph.html   # Сгенерированный HTML с графом PyVis
└─ .env                   # Секреты и параметры окружения (не коммитится)
```

---

## Установка и запуск

### 1. Клонирование и виртуальное окружение

```bash
git clone <repo-url>
cd Mem0_Graph

python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate

pip install -r requirements.txt
```

### 2. Настройка переменных окружения

Создайте файл `.env` в корне (пример):

```bash
OPENROUTER_API_KEY=...
OPENAI_BASE_URL=https://openrouter.ai/api/v1
```

> При необходимости добавьте другие переменные (например, если будете менять URL/логин/пароль Neo4j или параметры Mem0).

### 3. Запуск Neo4j через Docker

```bash
docker-compose up -d
```

Это поднимет контейнер `neo4j:5.26.0-community`:

- веб-интерфейс Neo4j Browser: `http://localhost:7474`  
- Bolt-порт: `bolt://localhost:7687`  
- логин/пароль по умолчанию: `neo4j` / `password123` (задано в `docker-compose.yml` и `mem0_graph/config.py`).

### 4. Запуск Streamlit-приложения

```bash
streamlit run app.py
```

После запуска откройте в браузере URL, который покажет Streamlit (обычно `http://localhost:8501`).

---

## Как это работает

- При первом заходе в `app.py` инициализируется:
  - `Mem0Agent` (из `mem0_graph.agent`) — обёртка над `Memory` от Mem0 и LLM‑клиентом OpenAI SDK;
  - `Neo4jGraphViz` (из `mem0_graph.graph_viz`) — обёртка над драйвером Neo4j и PyVis.

- В боковой панели Streamlit можно:
  - загрузить **TXT/PDF** — текст будет распарсен и добавлен в память через `Mem0Agent.add_memory(...)` с метаданными о файле;
  - посмотреть количество сохранённых воспоминаний;
  - проверить статус подключения к Neo4j;
  - очистить всю память пользователя.

- Во вкладке **«Чат с агентом»**:
  - пользователь пишет сообщение;
  - агент через `self.memory.search(...)` достаёт релевантные воспоминания;
  - формирует контекст и вызывает LLM (`openai/gpt-4o-mini` через OpenRouter);
  - сохраняет и вопрос, и ответ в память.

- Во вкладке **«Граф знаний»**:
  - `Neo4jGraphViz.save_graph(...)` делает Cypher‑запрос к Neo4j;
  - строит интерактивный граф PyVis (раскраска по типам узлов, подписи, всплывающие подсказки);
  - сохраняет HTML (`knowledge_graph.html`) и встраивает его в Streamlit.

---

## Скрипты и тесты

- **`scripts/debug_mem0.py`** — быстрая проверка того, что Mem0 и конфиг работают (add/search/get_all).
- **`scripts/check_types.py`** — смотрит тип `labels(n)` в Neo4j (удобно для отладки формата данных, приходящих из драйвера).
- **`scripts/inspect_neo4j.py`** — печатает:
  - какие есть лейблы узлов и их количество;
  - какие есть типы связей и их количество;
  - несколько примерных узлов и отношений.

- **`tests/test_memory_addition.py`** — небольшой тест на добавление и поиск воспоминаний через Mem0.
- **`tests/test_graph_query.py`** — выполняет запрос к Neo4j и печатает несколько первых записей.

---

## Дальнейшее развитие

Идеи, как можно развивать проект дальше:

- добавить аутентификацию пользователей и хранить `user_id` отдельно для каждого;
- вынести конфиг (`mem0_graph/config.py`) на окружение/конфигурационные файлы и поддержать разные профили (dev/stage/prod);
- расширить схему графа (отдельные типы сущностей, временные оси, веса связей);
- применить дополнительные алгоритмы анализа графа (PageRank, community detection и т.п.) и показывать их результаты в интерфейсе.

